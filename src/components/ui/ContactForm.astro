---
import { Send, User, Mail, Phone, MessageSquare } from "lucide-astro";

interface Props {
    variant?: "light" | "dark";
}

const { variant = "dark" } = Astro.props;

const isDark = variant === "dark";
const inputClasses = isDark
    ? "w-full px-4 py-3 bg-secondary-800/80 border border-secondary-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-400 transition-all duration-300 text-white placeholder-secondary-400 hover:bg-secondary-800 hover:border-secondary-500"
    : "w-full pl-10 pr-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 transition-colors";

const labelClasses = isDark
    ? "block text-sm font-medium text-secondary-300 mb-2"
    : "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2";

// Generate unique ID for this form instance
const uniqueId = Math.random().toString(36).substring(2, 11);
---

<div class="relative">
    <!-- Status Message -->
    <div
        id={`formStatus-${uniqueId}`}
        class="hidden mb-6 p-4 rounded-lg transition-all duration-300"
    >
    </div>

    <form id={`contactForm-${uniqueId}`} class="space-y-4 sm:space-y-6">
        <div class="grid sm:grid-cols-2 gap-4 sm:gap-6">
            <div>
                <label for="firstName" class={labelClasses}>First Name *</label>
                {
                    isDark ? (
                        <input
                            type="text"
                            id="firstName"
                            name="firstName"
                            required
                            class={inputClasses}
                            placeholder="Enter your first name"
                        />
                    ) : (
                        <div class="relative">
                            <User
                                class="absolute left-3 top-3 text-gray-400"
                                size={20}
                            />
                            <input
                                type="text"
                                id="firstName"
                                name="firstName"
                                required
                                class={inputClasses}
                                placeholder="Enter your first name"
                            />
                        </div>
                    )
                }
            </div>

            <div>
                <label for="lastName" class={labelClasses}>Last Name *</label>
                {
                    isDark ? (
                        <input
                            type="text"
                            id="lastName"
                            name="lastName"
                            required
                            class={inputClasses}
                            placeholder="Enter your last name"
                        />
                    ) : (
                        <div class="relative">
                            <User
                                class="absolute left-3 top-3 text-gray-400"
                                size={20}
                            />
                            <input
                                type="text"
                                id="lastName"
                                name="lastName"
                                required
                                class={inputClasses}
                                placeholder="Enter your last name"
                            />
                        </div>
                    )
                }
            </div>
        </div>

        <div class={isDark ? "block" : "grid sm:grid-cols-2 gap-4 sm:gap-6"}>
            <div>
                <label for="email" class={labelClasses}>Email Address *</label>
                {
                    isDark ? (
                        <input
                            type="email"
                            id="email"
                            name="email"
                            required
                            class={inputClasses}
                            placeholder="Enter your email address"
                        />
                    ) : (
                        <div class="relative">
                            <Mail
                                class="absolute left-3 top-3 text-gray-400"
                                size={20}
                            />
                            <input
                                type="email"
                                id="email"
                                name="email"
                                required
                                class={inputClasses}
                                placeholder="Enter your email address"
                            />
                        </div>
                    )
                }
            </div>

            <div class={isDark ? "mt-4 sm:mt-6" : ""}>
                <label for="phone" class={labelClasses}>Phone Number</label>
                {
                    isDark ? (
                        <input
                            type="tel"
                            id="phone"
                            name="phone"
                            class={inputClasses}
                            placeholder="Enter your phone number"
                        />
                    ) : (
                        <div class="relative">
                            <Phone
                                class="absolute left-3 top-3 text-gray-400"
                                size={20}
                            />
                            <input
                                type="tel"
                                id="phone"
                                name="phone"
                                class={inputClasses}
                                placeholder="Enter your phone number"
                            />
                        </div>
                    )
                }
            </div>
        </div>

        <div>
            <label for="message" class={labelClasses}>Message *</label>
            {
                isDark ? (
                    <textarea
                        id="message"
                        name="message"
                        rows="5"
                        required
                        class="w-full px-4 py-3 bg-secondary-800/80 border border-secondary-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-400 transition-all duration-300 resize-none text-white placeholder-secondary-400 hover:bg-secondary-800 hover:border-secondary-500"
                        placeholder="Tell us about your enquiry..."
                    />
                ) : (
                    <div class="relative">
                        <MessageSquare
                            class="absolute left-3 top-3 text-gray-400"
                            size={20}
                        />
                        <textarea
                            id="message"
                            name="message"
                            rows="6"
                            required
                            class="w-full pl-10 pr-4 py-3 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 resize-none transition-colors"
                            placeholder="Tell us about your inquiry or how we can help you..."
                        />
                    </div>
                )
            }
        </div>

        <button
            type="submit"
            id={`submitBtn-${uniqueId}`}
            class={isDark
                ? "w-full relative inline-flex items-center justify-center px-6 py-4 bg-gradient-to-r from-primary-600 via-primary-500 to-accent-600 text-white font-semibold rounded-xl shadow-xl hover:shadow-2xl transform hover:scale-105 transition-all duration-300 group overflow-hidden disabled:opacity-50 disabled:cursor-not-allowed"
                : "inline-flex items-center px-8 py-3 bg-gradient-to-r from-primary-600 to-accent-600 text-white font-semibold rounded-full hover:from-primary-700 hover:to-accent-700 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed"}
        >
            {
                isDark ? (
                    <>
                        <div class="absolute inset-0 bg-gradient-to-r from-accent-600 via-primary-500 to-primary-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
                        <span class="relative z-10 flex items-center">
                            <span>Send Message</span>
                            <Send
                                size={20}
                                class="ml-2 group-hover:translate-x-1 transition-transform duration-300"
                            />
                        </span>
                        <div class="absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-500">
                            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-1000" />
                        </div>
                    </>
                ) : (
                    <>
                        <Send class="mr-2" size={20} />
                        <span>Send Message</span>
                    </>
                )
            }
        </button>

        {
            isDark && (
                <p class="text-xs sm:text-sm text-secondary-400 text-center mt-4 leading-relaxed">
                    By submitting this form, you agree to our
                    <a
                        href="/privacy-policy"
                        class="text-primary-400 hover:text-primary-300 underline"
                    >
                        Privacy Policy
                    </a>
                    and consent to being contacted by our admissions team.
                </p>
            )
        }
    </form>
</div>

<script define:vars={{ uniqueId }}>
    const contactForm = document.getElementById(`contactForm-${uniqueId}`);
    const formStatus = document.getElementById(`formStatus-${uniqueId}`);

    if (contactForm && formStatus) {
        contactForm.addEventListener("submit", async (e) => {
            e.preventDefault();

            const submitBtn = contactForm.querySelector(
                'button[type="submit"]',
            );
            const formData = new FormData(contactForm);
            const data = Object.fromEntries(formData.entries());
            data.access_key = "9f71686b-384c-46ee-8f97-4ce6672d1d30";

            if (submitBtn) submitBtn.disabled = true;
            const btnSpans = submitBtn?.querySelectorAll("span");
            const textSpan = btnSpans
                ? Array.from(btnSpans).find(
                      (span) => span.textContent?.trim() === "Send Message",
                  )
                : null;
            if (textSpan) textSpan.textContent = "Sending...";

            try {
                const response = await fetch(
                    "https://api.web3forms.com/submit",
                    {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            Accept: "application/json",
                        },
                        body: JSON.stringify(data),
                    },
                );

                await response.json();

                formStatus.textContent =
                    "✓ Message sent successfully! We'll get back to you soon.";
                formStatus.className =
                    "mb-6 p-4 rounded-lg bg-green-500/10 border border-green-500/50 text-green-400 text-sm transition-all duration-300";
                contactForm.reset();
            } catch (error) {
                formStatus.textContent =
                    "✗ Something went wrong. Please try again.";
                formStatus.className =
                    "mb-6 p-4 rounded-lg bg-red-500/10 border border-red-500/50 text-red-400 text-sm transition-all duration-300";
            } finally {
                if (submitBtn) submitBtn.disabled = false;
                if (textSpan) textSpan.textContent = "Send Message";

                setTimeout(() => {
                    formStatus.className =
                        "hidden mb-6 p-4 rounded-lg transition-all duration-300";
                }, 5000);
            }
        });
    }
</script>
